<!DOCTYPE html>
<html lang="en">
<!-- [HEAD SECTION REMAINS EXACTLY THE SAME AS BEFORE] -->
<body>
    <!-- [ALL HTML REMAINS EXACTLY THE SAME UNTIL THE SCRIPT TAG] -->

    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        // 1. Initialize EmailJS
        emailjs.init("iTzoppHcrXT5MN1Iq");

        // 2. Load order data when page opens
        document.addEventListener('DOMContentLoaded', function() {
            // [ALL DISPLAY CODE REMAINS THE SAME UNTIL EMAIL SENDING]

            // 3. Handle order confirmation
            document.getElementById('confirmOrder').addEventListener('click', async function() {
                const button = this;
                button.disabled = true;
                document.getElementById('spinner').style.display = 'inline-block';

                try {
                    const orderId = Math.floor(100000 + Math.random() * 900000);
                    const now = new Date();
                    
                    // Format products as text
                    const productsText = orderData.products.map(p => 
                        `${p.quantity}x ${p.name} @ ${p.price} PKR = ${(p.quantity * p.price).toFixed(2)} PKR`
                    ).join('\n');

                    // Create complete order summary
                    const orderSummary = `
CUSTOMER DETAILS:
Name: ${orderData.name}
Phone: ${orderData.phone}
Email: ${orderData.email}
Address: ${orderData.address}

ORDER ITEMS:
${productsText}
`;

                    // Send customer email (unchanged)
                    await emailjs.send("service_cor6xnd", "template_3e494ui", {
                        name: orderData.name,
                        order_id: orderId,
                        total: orderData.total,
                        phone: orderData.phone,
                        email: orderData.email
                    });

                    // Send admin email with PERFECTLY MATCHED variables
                    await emailjs.send("service_cor6xnd", "template_y1yh0b9", {
                        customer_name: orderData.name,
                        customer_phone: orderData.phone,
                        customer_email: orderData.email,
                        order_id: orderId,
                        order_summary: orderSummary,
                        order_total: orderData.total,
                        order_timestamp: now.toLocaleString()
                    });

                    window.location.href = 'thankyou.html';
                } catch (error) {
                    console.error("Email failed:", error);
                    alert("Order confirmed! Your reference is: #" + orderId);
                    window.location.href = 'thankyou.html';
                } finally {
                    button.disabled = false;
                    document.getElementById('spinner').style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
