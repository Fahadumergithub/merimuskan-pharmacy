<script>
    // Initialize EmailJS with your credentials
    emailjs.init("iTzoppHcrXT5MN1Iq");
    
    document.addEventListener('DOMContentLoaded', function() {
        // Retrieve and display order data (keep your existing code)
        const orderData = JSON.parse(sessionStorage.getItem('orderData'));
        if (!orderData) window.location.href = 'index.html';

        // Display customer details
        const customerDetails = document.getElementById('customerDetails');
        customerDetails.innerHTML = `
            <div class="info-row">
                <div class="info-label">Name:</div>
                <div class="info-value">${orderData.name}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Phone:</div>
                <div class="info-value">${orderData.phone}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Email:</div>
                <div class="info-value">${orderData.email}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Address:</div>
                <div class="info-value">${orderData.address}</div>
            </div>
        `;

        // Display order items
        const orderItems = document.getElementById('orderItems');
        orderData.products.forEach(product => {
            const itemTotal = (product.price * product.quantity).toFixed(2);
            orderItems.innerHTML += `
                <div class="product-item">
                    <div>
                        <strong>${product.name}</strong>
                        <div>${product.quantity} Ã— ${product.price} PKR</div>
                    </div>
                    <div>${itemTotal} PKR</div>
                </div>
            `;
        });

        // Display total
        document.getElementById('orderTotal').textContent = orderData.total;

        // Handle order confirmation
        document.getElementById('confirmOrder').addEventListener('click', async function() {
            const button = this;
            button.disabled = true;
            document.getElementById('spinner').style.display = 'inline-block';

            try {
                const orderId = Math.floor(100000 + Math.random() * 900000);
                const orderDetails = orderData.products.map(p => 
                    `${p.quantity}x ${p.name} - ${p.price} PKR`
                ).join('\n');

                // 1. Send customer confirmation email (only essential fields)
                await emailjs.send("service_cor6xnd", "template_3e494ui", {
                    name: orderData.name,
                    order_id: orderId,
                    total: orderData.total,
                    phone: orderData.phone,
                    email: orderData.email
                });

                // 2. Send admin notification email (only essential fields)
                await emailjs.send("service_cor6xnd", "template_y1yh0b9", {
                    name: orderData.name,
                    phone: orderData.phone,
                    email: orderData.email,
                    total: orderData.total
                });

                window.location.href = 'thankyou.html';
            } catch (error) {
                console.error("Email Error:", error);
                alert("Order confirmed! You'll receive a confirmation shortly.");
                window.location.href = 'thankyou.html';
            } finally {
                button.disabled = false;
                document.getElementById('spinner').style.display = 'none';
            }
        });
    });
</script>
